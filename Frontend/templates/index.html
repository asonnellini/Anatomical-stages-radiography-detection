{% extends 'layout.html' %}

{% block head %}
  <title>Home</title>
{% endblock %}

{% block body %}

  {% include 'base.html' %}


  <script>
    const inpFile = document.getElementById('inpFile');
    const previewContainer =  document.getElementById('imagePreview');
    const previewImage =  previewContainer.querySelector('.image-preview__image');
    const previewDefaultText =  previewContainer.querySelector('.image-preview__default-text');

    inpFile.addEventListener('change', function () {
      const file = this.files[0];
      console.log(file);
      if (file){
        const reader = new FileReader();

        previewDefaultText.style.display ='none';
        previewImage.style.display = 'block';

        reader.addEventListener('load', function() {
          previewImage.src = this.result;
          //document.getElementById("pickupid").value = previewImage.src;
        });
        reader.readAsDataURL(file);
        document.getElementById("pickupid").value = file;

      } else {
        previewDefaultText.style.display = null;
        previewImage.style.display = null;
        previewImage.setAttribute('src', '');
        document.getElementById("pickupid").value = null;
      }
    });
  </script>

  <script>  
  
  function sendToS3() {

    var backendip = 'localhost'
    var port = 3000
    var data_uri = $('#pickupid').contents()

    

    const inpFile = document.getElementById('inpFile');
    const previewDefaultText =  previewContainer.querySelector('.image-preview__default-text');
    const previewImage =  previewContainer.querySelector('.image-preview__image');
    document.getElementById("output").value = previewImage.src

    //console.log(previewImage.src);
    var formdata = new FormData();
  
    formdata.append("image", inpFile.files[0], "/C:/Users/barth/Downloads/MicrosoftTeams-image (2).png");
    console.log(formdata);


    var requestOptions = {
      method: 'POST',
      body: formdata,
      redirect: 'follow',
      mode: 'no-cors'
    };

    fetch("http://localhost:3000/upload", requestOptions)
    .then(response => response.text())
    .then(result => console.log(result))
    .catch(error => console.log('error', error));

    // .then(result => {
    //   document.getElementById('output').innerHTML = result; // to put the result in the metadata zone
    // });
            
    }

    

   
  
  </script>
{% endblock %}
